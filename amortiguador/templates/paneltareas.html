{% extends 'base.html' %} {% block content %}
<div class="container mt-3 bg-light p-4 rounded">
  <div class="container mt-4">
    <h2 class="mb-4">Panel de Tareas</h2>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="accion" value="elegiroperario" />
      <label for="operario">Seleccionar Operario:</label>
      <select name="operario" id="operario" class="form-select mb-4">
        <option value="">Seleccione un operario</option>
        {% for operario in operarios %}
        <option value="{{ operario.id }}">
          {{ operario.nombre }} {{ operario.apellido }}
        </option>
        {% endfor %}
      </select>
      <select name="estado" id="estado" class="form-select mb-4">
        <option value="">Seleccione un estado</option>
        <option value="pendiente">Pendiente</option>
        <option value="por reparar">Por Reparar</option>
      </select>
      <select name="prioridad" id="prioridad" class="form-select mb-4">
        <option value="">Seleccione una prioridad</option>
        <option value="alta">Alta</option>
        <option value="media">Media</option>
        <option value="baja">Baja</option>
      </select>
      <button type="submit" class="btn btn-primary">Ver Tareas</button>
    </form>
  </div>
  {% if tareas %}
  <h3>Tareas Pendientes para {{ operario.nombre }} {{ operario.apellido }}</h3>
  <ul class="list-group">
    {% for info in tareas_info|default:tareas %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      {% if info.tarea %}
        {% with tarea=info.tarea %}
          <div>
            {{ tarea.amortiguador.nroSerieamortiguador }} - Prioridad: {{tarea.prioridad}} - Estado: {{ tarea.estado }}
          </div>
          <div>
            {% if info.has_stock %}
              <a href="/detalle_tarea/{{ tarea.id }}" class="btn btn-success btn-sm">Empezar tarea</a>
            {% else %}
              <button class="btn btn-secondary btn-sm" disabled>Falta stock</button>
            {% endif %}
          </div>
        {% endwith %}
      {% else %}
        <div>
          {{ info.amortiguador.nroSerieamortiguador }} - Prioridad: {{info.prioridad}} - Estado: {{ info.estado }}
          <a href="/detalle_tarea/{{ info.id }}" class="btn btn-info btn-sm ms-2">Ver Detalles</a>
        </div>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
  {% endif %}
  
  <hr />

</div>
{% endblock %} {% block extra_js %} {% endblock %}
